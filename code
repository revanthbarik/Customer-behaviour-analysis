from google.colab import files
uploaded = files.upload() #cell 1
 
import pandas as pd
data = pd.read_csv('RTD.csv', nrows=10000)
data.head() cell 2

print("Columns:", data.columns.tolist())
data.info()

from IPython.core import error
import numpy as np
import pandas as pd

data = pd.read_csv('RTD.csv')

#date to datetime format
data['Date'] = pd.to_datetime(data['Date'])

#drop missing values
data.dropna(subset=['Customer_Name','Total_Cost'],inplace=True)
data['Total_Cost'] = pd.to_numeric(data['Total_Cost'], errors='coerce')

print("Shape:", data.shape)
print("Columns:", data.columns.tolist())
print(data.head())

import sqlite3

conn = sqlite3.connect(":memory:")
data.to_sql('RetailData', conn, index=False, if_exists='replace')
query = """
SELECT 
    Customer_Name,
    COUNT(Transaction_ID) AS Frequency,
    SUM(Total_Cost) AS Monetary,
    MAX(Date) AS LastPurchase
FROM RetailData
GROUP BY Customer_Name
"""  
rfm = pd.read_sql_query(query, conn)
rfm['LastPurchase'] = pd.to_datetime(rfm['LastPurchase'])
rfm.head()


# Recency score
rfm['R_Score'] = pd.cut(rfm['Recency'], bins=4, labels=[4,3,2,1])

# Frequency score
rfm['F_Score'] = pd.cut(rfm['Frequency'], bins=4, labels=[1,2,3,4])

# Monetary score
rfm['M_Score'] = pd.cut(rfm['Monetary'], bins=4, labels=[1,2,3,4])

# Final segment code
rfm['Segment'] = (
    rfm['R_Score'].astype(str) + 
    rfm['F_Score'].astype(str) + 
    rfm['M_Score'].astype(str)
)

rfm.head()

# Average Order Value
rfm['Avg_Order_Value'] = rfm['Monetary'] / rfm['Frequency']

# Simple CLV Model (AOV * Frequency)
rfm['CLV'] = rfm['Avg_Order_Value'] * rfm['Frequency']

rfm[['Customer_Name', 'Frequency', 'Monetary', 'Avg_Order_Value', 'CLV', 'Churn', 'Segment']].head()

rfm['CLV'] = rfm['CLV'].round(2)
rfm['Avg_Order_Value'] = rfm['Avg_Order_Value'].round(2)
rfm[['Customer_Name','Avg_Order_Value','CLV']].head() #display the values toshow the decimal points

#import the file 

rfm.to_csv('Customer_Behavior_Analysis.csv', index=False)

from google.colab import files
files.download('Customer_Behavior_Analysis.csv')



  
